<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8" />

  
  <title>AzureChallenge Leeds</title>

  
  





  
  <meta name="author" content="Scott Guymer" />
  <meta name="description" content="This week I attended the Azure Challenge in Leeds hosted by Microsoft at the Hilton Leeds City. This was a 2 day event focussing on Kubernetes in Azure. There was very little information about the format and content and it felt like it was being kept under wraps!
The only info we were given was
  Install the Azure CLI 2.0 Install Docker Install Kubectl Install Postman - this is optional but useful   I arrived a bit late and sat down with Team 8 that consisted of Lee Dyche, Paul Latham and David Betteridge." />

  
  
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@mr_scottguymer" />
    <meta name="twitter:title" content="AzureChallenge Leeds" />
    <meta name="twitter:description" content="This week I attended the Azure Challenge in Leeds hosted by Microsoft at the Hilton Leeds City. This was a 2 day event focussing on Kubernetes in Azure. There was very little information about the format and content and it felt like it was being kept under wraps!
The only info we were given was
  Install the Azure CLI 2.0 Install Docker Install Kubectl Install Postman - this is optional but useful   I arrived a bit late and sat down with Team 8 that consisted of Lee Dyche, Paul Latham and David Betteridge." />
    <meta name="twitter:image" content="https://www.scottguymer.co.uk/img/avatar.jpg" />
  

  
  <meta property="og:type" content="article" />
  <meta property="og:title" content="AzureChallenge Leeds" />
  <meta property="og:description" content="This week I attended the Azure Challenge in Leeds hosted by Microsoft at the Hilton Leeds City. This was a 2 day event focussing on Kubernetes in Azure. There was very little information about the format and content and it felt like it was being kept under wraps!
The only info we were given was
  Install the Azure CLI 2.0 Install Docker Install Kubectl Install Postman - this is optional but useful   I arrived a bit late and sat down with Team 8 that consisted of Lee Dyche, Paul Latham and David Betteridge." />
  <meta property="og:url" content="https://www.scottguymer.co.uk/post/azurechallenge-leeds/" />
  <meta property="og:image" content="https://www.scottguymer.co.uk/img/avatar.jpg" />




<meta name="generator" content="Hugo 0.31.1" />


<link rel="canonical" href="https://www.scottguymer.co.uk/post/azurechallenge-leeds/" />
<link rel="alternative" href="https://www.scottguymer.co.uk/index.xml" title="Scott Guymer" type="application/atom+xml" />


<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="format-detection" content="telephone=no,email=no,adress=no" />
<meta http-equiv="Cache-Control" content="no-transform" />


<meta name="robots" content="index,follow" />
<meta name="referrer" content="origin-when-cross-origin" />
<meta name="google-site-verification" content="Rop88G3o4ZxIlfG_B3VHOKboh8LM_UpKZTB1d1CTbIE" />






<link rel="apple-touch-icon" sizes="57x57" href="https://www.scottguymer.co.uk/apple-touch-icon-57x57.png?v=wAOKYnNQj4">
<link rel="apple-touch-icon" sizes="60x60" href="https://www.scottguymer.co.uk/apple-touch-icon-60x60.png?v=wAOKYnNQj4">
<link rel="apple-touch-icon" sizes="72x72" href="https://www.scottguymer.co.uk/apple-touch-icon-72x72.png?v=wAOKYnNQj4">
<link rel="apple-touch-icon" sizes="76x76" href="https://www.scottguymer.co.uk/apple-touch-icon-76x76.png?v=wAOKYnNQj4">
<link rel="apple-touch-icon" sizes="114x114" href="https://www.scottguymer.co.uk/apple-touch-icon-114x114.png?v=wAOKYnNQj4">
<link rel="apple-touch-icon" sizes="120x120" href="https://www.scottguymer.co.uk/apple-touch-icon-120x120.png?v=wAOKYnNQj4">
<link rel="apple-touch-icon" sizes="144x144" href="https://www.scottguymer.co.uk/apple-touch-icon-144x144.png?v=wAOKYnNQj4">
<link rel="apple-touch-icon" sizes="152x152" href="https://www.scottguymer.co.uk/apple-touch-icon-152x152.png?v=wAOKYnNQj4">
<link rel="apple-touch-icon" sizes="180x180" href="https://www.scottguymer.co.uk/apple-touch-icon-180x180.png?v=wAOKYnNQj4">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.scottguymer.co.uk/favicon-32x32.png?v=wAOKYnNQj4">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.scottguymer.co.uk/favicon-16x16.png?v=wAOKYnNQj4">
<link rel="manifest" href="https://www.scottguymer.co.uk/site.webmanifest?v=wAOKYnNQj4">
<link rel="mask-icon" href="https://www.scottguymer.co.uk/safari-pinned-tab.svg?v=wAOKYnNQj4" color="#5bbad5">
<link rel="shortcut icon" href="https://www.scottguymer.co.uk/favicon.ico?v=wAOKYnNQj4">
<meta name="msapplication-TileColor" content="#2b5797">
<meta name="msapplication-TileImage" content="/mstile-144x144.png?v=wAOKYnNQj4">
<meta name="theme-color" content="#ffffff">



<link rel="stylesheet" href="//cdn.bootcss.com/video.js/6.2.8/alt/video-js-cdn.min.css" />

<link rel="stylesheet" href="https://www.scottguymer.co.uk/css/bundle.css" />


  
  <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <script src="//cdn.bootcss.com/video.js/6.2.8/ie8/videojs-ie8.min.js"></script>
  <![endif]-->

<!--[if lte IE 11]>
    <script src="//cdn.bootcss.com/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->


<script src="//cdn.bootcss.com/object-fit-images/3.2.3/ofi.min.js"></script>


<script src="//cdn.bootcss.com/smooth-scroll/12.1.4/js/smooth-scroll.polyfills.min.js"></script>


</head>
  <body>
    
    <div class="suspension">
      <a title="Go to top" class="to-top is-hide"><span class="icon icon-up"></span></a>
      
        
        <a title="Go to comments" class="to-comment" href="#disqus_thread"><span class="icon icon-comment"></span></a>
        
      
    </div>
    
    
  <header class="site-header">
  <img class="avatar" src="https://www.scottguymer.co.uk/images/main/scottguymer.jpg" alt="Avatar">
  
  <h2 class="title">Scott Guymer</h2>
  
  <p class="subtitle">~ Software Engineer ~</p>
  <button class="menu-toggle" type="button">
    <span class="icon icon-menu"></span>
  </button>
  <nav class="site-menu collapsed">
    <h2 class="offscreen">Main Menu</h2>
    <ul class="menu-list">
      
      
      
      
        <li class="menu-item
            
            
            
              is-active
            ">
            <a href="https://www.scottguymer.co.uk/">Home</a>
          </li>
      
        <li class="menu-item
            
            
            ">
            <a href="https://www.scottguymer.co.uk/tags/">Tags</a>
          </li>
      
        <li class="menu-item
            
            
            ">
            <a href="https://www.scottguymer.co.uk/about/">About</a>
          </li>
      
    </ul>
  </nav>
  <nav class="social-menu collapsed">
    <h2 class="offscreen">Social Networks</h2>
    <ul class="social-list">

      
      <li class="social-item">
        <a href="mailto:blog@scottguymer.co.uk" title="Email"><span class="icon icon-email"></span></a>
      </li>

      
      <li class="social-item">
        <a href="//github.com/scottguymer" title="GitHub"><span class="icon icon-github"></span></a>
      </li>

      <li class="social-item">
        <a href="//twitter.com/mr_scottguymer" title="Twitter"><span class="icon icon-twitter"></span></a>
      </li>

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <li class="social-item">
        <a href="//www.linkedin.com/in/scottguymer" title="Linkedin"><span class="icon icon-linkedin"></span></a>
      </li>

      

      

      

      <li class="social-item">
        <a href="https://www.scottguymer.co.uk/index.xml"><span class="icon icon-rss" title="RSS"></span></a>
      </li>

    </ul>
  </nav>
</header>

  <section class="main post-detail">
    <header class="post-header">
      <h1 class="post-title">AzureChallenge Leeds</h1>
      <p class="post-meta">@Scott Guymer · Mar 29, 2018 · 6 min read</p>
    </header>
    <article class="post-content">

<p>This week I attended the Azure Challenge in Leeds hosted by Microsoft at the Hilton Leeds City. This was a 2 day event focussing on Kubernetes in Azure. There was very little information about the format and content and it felt like it was being kept under wraps!</p>

<p>The only info we were given was</p>

<blockquote>
<ul>
<li>Install the Azure CLI 2.0</li>
<li>Install Docker</li>
<li>Install Kubectl</li>
<li>Install Postman - this is optional but useful</li>
</ul>
</blockquote>

<p>I arrived a bit late and sat down with Team 8 that consisted of Lee Dyche, Paul Latham and David Betteridge.</p>

<h2 id="this-was-not-your-average-workshop">This was not your average workshop&hellip;</h2>

<p>It quickly became clear that this wasn&rsquo;t your average workshop and we were in for something good.</p>

<blockquote>
<p>We are not going to be giving your any instructions&hellip;.</p>
</blockquote>

<p>This was a good start.</p>

<p>We were just given a list of goals to achieve to get a cluster up and kick off the application on it and after that there was just a list of challenges. Each with a couple of links to some reading. We were going to learn a lot today&hellip;</p>

<h2 id="starting-off">Starting off</h2>

<p>We had to make a couple of decisions up front</p>

<ul>
<li>Use <a href="https://docs.microsoft.com/en-us/azure/aks/">AKS</a> or <a href="https://github.com/Azure/acs-engine">ACS Engine</a>?</li>
<li>What size nodes did we want?</li>
</ul>

<p>These were pretty simple, we picked AKS as it would get us up and running quicker and some mid range nodes with 1 CPU and 8Gb RAM.</p>

<p>The cluster came up fairly quickly with just one command line and about 10 minutes to wait.</p>

<p>We then had to get the pre-created application up and running in the cluster. All we had was a couple of references to docker hub and github. A couple of yaml files and helm commands later and we were in business.</p>

<p>We added our site to the traffic manager that was being monitored for uptime and we were live!!</p>

<h2 id="getting-more-complex">Getting more complex</h2>

<p>Now started the challenges. There were lots of them.</p>

<p>There were a few things we knew we had to do out of the list and they were pretty obvious</p>

<ul>
<li>Monitoring</li>
<li>CI/CD</li>
</ul>

<p>But there were so many choices. I picked monitoring to tackle while Lee and David tackled CI/CD. I decided to start with <a href="https://docs.microsoft.com/en-us/azure/aks/tutorial-kubernetes-monitor">Azure OMS</a> and see what sort of visibility that gave us. But why stop at one monitoring system? So I installed <a href="https://www.datadoghq.com/blog/monitor-kubernetes-docker/">DataDog</a> too so I could compare and contrast the information available. (I have since tried Prometheus Operator too, which is great!)</p>

<p><img src="https://www.scottguymer.co.uk/uploads/2018/03/29/k8s-dash-2.png" alt="" /></p>

<p>So we now had some visibility into our cluster and some way to build and deploy things to it!</p>

<h2 id="load-testing">Load testing</h2>

<p>It wasn&rsquo;t too long before things started going wrong!!</p>

<p>It took a while for us to realise that we were being secretly load tested and it was taking our cluster down!! Panic!</p>

<p>We had a big problem with some of our components and they had crashed hard. We had some serious downtime and went from first to last in the uptime stakes! :(</p>

<p><img src="https://www.scottguymer.co.uk/uploads/2018/03/29/DumpsterFire2.jpg" alt="" /></p>

<p>It took us a while to get back up and running and we spent some time investigating the issues we had so they didn&rsquo;t happen again. We decided to switch come components out for Azure services so we could scale and tune them better.</p>

<p>At this point we also decided that we probably needed a dev namespace for testing our improvements.</p>

<p>It was the end of day 1 already! We would have to come back tomorrow and continue tuning our system.</p>

<h2 id="the-competition">The Competition</h2>

<p>We all came back together the next day and discussed our plan of attack over a coffee. We implemented some more changes and made a couple of changes to our resource profile and implemented some autoscaling of the web api that was being tested.</p>

<p>A couple more load tests later and things were hanging together nicely. We seemed to be handling the load to a certain point and then the performance was just tailing off and hitting the floor as something became overloaded.</p>

<p>We took some time to investigate the metrics to see where out bottleneck was that was causing our performance hit. We found that our persistence layer simply couldn&rsquo;t keep up with the number of incoming requests. We made a couple more tweaks and asked for another load test.</p>

<p>The result were great. We jumped straight into first place, with a bit of a lead! But it just wasn&rsquo;t enough for us, we wanted more power.</p>

<h2 id="performance-improvements">Performance improvements</h2>

<p>We made some pretty decent performance tweaks to our platform. We tuned the Kubernetes resource request and limits to pack more instances into our servers. We also made sure that we had pre-scaled our service to take the load and made the autoscaler scale up the service more aggressively.</p>

<p>On the Azure side we made sure that our services were tuned to handle the load test. We spent a lot of time looking at the metrics and tweaking the settings.</p>

<p>We quickly figured out that the persistence was still our big bottleneck. So we did some tweaking of the config to try get more throughput. That should get us some more performance from the front end. Time for another load test.. This was going to be good&hellip;</p>

<p><img src="https://www.scottguymer.co.uk/uploads/2018/03/29/photofinish.jpg" alt="" /></p>

<p>It was a draw&hellip;. Exactly the same stats as Team 7!!!</p>

<h2 id="team8-ftw">Team8 FTW!</h2>

<p>There was going to be a decider&hellip; One final load test to separate the teams. Again the persistence was still seeming like our big bottleneck. It seemed liked we were already at our maximum performance for the instance, it took us a while to realise that there was still some more tweaking we could do&hellip; We decided to go for it and made a quick last minute update to the configuration, out simply we turned the dial up to 11.</p>

<p><img src="https://www.scottguymer.co.uk/uploads/2018/03/29/volume-11-smushed.jpg" alt="" /></p>

<p>It was the final load test&hellip;. This was it..</p>

<p>The results were awesome! We were in first place by quite a margin with low response times and very few errors. We had served 1000s of requests during the test and our requests per second were the highest on the leaderboard. We had won in the performance stakes by quite a margin! Even our availability was great for the 2 days of the event.</p>

<p>Our prize was a copy of <a href="http://amzn.eu/hh5St3h">Kubernetes: Up and Running</a> each. (Which would have been good on day 1) I would highly recommend this book as your first port of call should you want to get up to speed with Kubernetes. Its simple, concise and covers all the bases. As a bonus its co-authored by the founders of Kubernetes so you are getting the info straight from the experts!</p>

<p>The event was awesome. The format was new for me and was a great forum for learning and experimenting and who doesn&rsquo;t like a bit of competition. The challenges were just enough to learn a lot about Kubernetes and Azure over the 2 days.</p>

<p>I want to say a big thanks to <a href="https://twitter.com/techdiction">Marcus Robinson</a> and the team from Microsoft for hosting the event and inviting us.</p>
</article>
    <footer class="post-footer">
      
      <ul class="post-tags">
        
          <li><a href="https://www.scottguymer.co.uk/tags/kubernetes"><span class="tag">Kubernetes</span></a></li>
        
          <li><a href="https://www.scottguymer.co.uk/tags/azure"><span class="tag">Azure</span></a></li>
        
      </ul>
      
      <p class="post-copyright">
        © This post is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License，please give source if you wish to quote or reproduce.
      </p>
    </footer>
    
      <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "scottguymer" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
    
  </section>
  <footer class="site-footer">
  <p>© 2017-2018 Scott Guymer</p>
  <p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with theme <a href="https://github.com/laozhu/hugo-nuo" target="_blank">Nuo</a>.</p>
  
</footer>



<script async src="//cdn.bootcss.com/video.js/6.2.8/alt/video.novtt.min.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
      extensions: ["AMSmath.js", "AMSsymbols.js"] }
    }
  });
</script>
<script type="text/x-mathjax-config">
  // Fix <code> tags after MathJax finishes running. This is a
  // hack to overcome a shortcoming of Markdown. Discussion at
  // https://github.com/mojombo/jekyll/issues/199
  MathJax.Hub.Queue(() => {
    MathJax.Hub.getAllJax().map(v => v.SourceElement().parentNode.className += ' has-jax');
  });
</script>

<script src="https://www.scottguymer.co.uk/js/bundle.js"></script>


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-113812052-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>





  </body>
</html>
